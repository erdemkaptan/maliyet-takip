<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>TERMİNAL - PORTFÖY ANALİZİ</title>
    <style>
        body { 
            background-color: #000; 
            color: #ffb800; 
            font-family: 'Courier New', Courier, monospace; 
            padding: 20px; 
            margin: 0;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            border: 1px solid #333; 
            padding: 20px; 
        }
        header { 
            border-bottom: 2px solid #ffb800; 
            margin-bottom: 20px; 
            display: flex; 
            justify-content: space-between;
            align-items: center;
            padding-bottom: 5px;
        }
        h1 { font-size: 18px; margin: 0; text-transform: uppercase; }

        .controls { 
            display: grid; 
            grid-template-columns: 1.5fr 1fr 1fr; 
            gap: 20px; 
            margin-bottom: 30px; 
            background: #111;
            padding: 15px;
            border: 1px solid #333;
        }
        .input-box label { font-size: 11px; display: block; margin-bottom: 5px; color: #aaa; }
        input { 
            background: #000; 
            border: 1px solid #ffb800; 
            color: #ffb800;
            padding: 5px;
            font-family: inherit;
            width: 100%;
            box-sizing: border-box;
        }

        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 15px; 
            margin-bottom: 30px; 
        }
        .stat-card { 
            background: #111; 
            border-left: 4px solid #ffb800; 
            padding: 15px; 
        }
        .stat-card h3 { margin: 0; font-size: 12px; color: #aaa; text-transform: uppercase; }
        .stat-value { font-size: 24px; font-weight: bold; margin-top: 5px; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { 
            background: #222; 
            color: #00efff; 
            font-size: 12px; 
            padding: 10px; 
            text-align: right;
            border-bottom: 1px solid #333;
        }
        td { 
            padding: 8px; 
            font-size: 14px; 
            text-align: right; 
            border-bottom: 1px solid #111;
        }
        tr:hover { background: #111; }

        .profit { color: #00ff00; } 
        .loss { color: #ff0000; }   
        
        button { 
            background: #ffb800; 
            color: #000; 
            border: none; 
            padding: 8px 15px; 
            cursor: pointer; 
            font-family: inherit; 
            font-weight: bold;
            margin-top: 10px;
            text-transform: uppercase;
        }
        button:hover { background: #e6a600; }

        .upload-area { 
            border: 1px dashed #ffb800; 
            padding: 15px; 
            text-align: center; 
            position: relative;
        }
        .upload-area input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>BİLGİ TERMİNALİ | PORTFÖY_ANALİZ</h1>
        <div id="clock" style="font-size: 12px;"></div>
    </header>

    <div class="controls">
        <div class="upload-area">
            JSON_VERİ_YÜKLE
            <input type="file" id="jsonInput" accept=".json">
        </div>
        <div class="input-box">
            <label>KOMİSYON (ON BİNDE):</label>
            <input type="number" id="commissionRate" value="9">
        </div>
        <div class="input-box">
            <label>GÜNCEL_FİYAT (TRY):</label>
            <input type="number" id="currentPrice" value="0" step="0.01">
            <button onclick="recalculate()">ANALİZİ_BAŞLAT</button>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <h3>MEVCUT_POZİSYON</h3>
            <div id="remainingQty" class="stat-value">0</div>
        </div>
        <div class="stat-card">
            <h3>PSİKOLOJİK_MALİYET</h3>
            <div id="psyCost" class="stat-value">0,00</div>
        </div>
        <div class="stat-card">
            <h3>ANLIK_KAR_ZARAR</h3>
            <div id="unrealizedProfit" class="stat-value">0,00</div>
        </div>
    </div>

    <table id="mainTable">
        <thead>
            <tr>
                <th style="text-align: left;">TARİH</th>
                <th style="text-align: center;">HİSSE</th>
                <th style="text-align: center;">YÖN</th>
                <th>FİYAT</th>
                <th>ADET</th>
                <th>NET_NAKİT</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
    let rawData = [];
    const formatTR = (num, fix = 2) => num.toLocaleString('tr-TR', { minimumFractionDigits: fix, maximumFractionDigits: fix });

    function updateClock() {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleString('tr-TR');
    }
    setInterval(updateClock, 1000);
    updateClock();

    document.getElementById('jsonInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => { 
            try {
                rawData = JSON.parse(event.target.result); 
                calculate(); 
            } catch(e) {
                alert("JSON dosyası geçersiz.");
            }
        };
        reader.readAsText(file);
    });

    function recalculate() { if (rawData.length > 0) calculate(); }

    function calculate() {
        const commRate = parseFloat(document.getElementById('commissionRate').value) / 10000;
        const currentPrice = parseFloat(document.getElementById('currentPrice').value) || 0;
        let totalQty = 0;
        let netCashFlow = 0; 
        
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = '';

        const sorted = rawData.sort((a,b) => {
            const dateA = a.tarih.split('/').reverse().join('-');
            const dateB = b.tarih.split('/').reverse().join('-');
            return new Date(dateA) - new Date(dateB);
        });

        sorted.forEach(item => {
            const rawAmount = item.fiyat * item.adet;
            const comm = rawAmount * commRate;
            let effect = 0;

            if (item.islem.toLowerCase() === 'alış') {
                effect = (rawAmount + comm);
                netCashFlow += effect;
                totalQty += item.adet;
            } else {
                effect = (rawAmount - comm);
                netCashFlow -= effect;
                totalQty -= item.adet;
            }

            tableBody.innerHTML += `<tr>
                <td style="text-align: left;">${item.tarih}</td>
                <td style="text-align: center;">${item.hisse}</td>
                <td style="text-align: center; color: ${item.islem.toLowerCase() === 'alış' ? '#00ff00' : '#ff0000'}">${item.islem.toUpperCase()}</td>
                <td>${formatTR(item.fiyat)}</td>
                <td>${formatTR(item.adet, 0)}</td>
                <td style="color: ${item.islem.toLowerCase() === 'alış' ? '#ffb800' : '#00efff'}">${formatTR(effect)}</td>
            </tr>`;
        });

        const psyMaliyet = totalQty > 0 ? (netCashFlow / totalQty) : 0;
        const unrealized = (totalQty * currentPrice) - netCashFlow;

        document.getElementById('remainingQty').innerText = formatTR(totalQty, 0);
        document.getElementById('psyCost').innerText = formatTR(psyMaliyet, 4);
        document.getElementById('unrealizedProfit').innerText = formatTR(unrealized);

        document.getElementById('unrealizedProfit').className = 'stat-value ' + (unrealized >= 0 ? 'profit' : 'loss');
        document.getElementById('psyCost').style.color = psyMaliyet <= 0 ? '#00ff00' : '#ffb800';
    }
</script>
</body>
</html>
